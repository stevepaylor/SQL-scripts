USE [SDSVJPRD_Reporting]
GO

/****** Object:  View [ACCOUNTING].[VIEW_SFTC_VALUE]    Script Date: 12/13/2021 9:06:22 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [ACCOUNTING].[VIEW_SFTC_VALUE]
AS
SELECT ASST_ID
	,NAMEDASSTID
	,GAMEDAY
	,UPPER(PERIODTYPE) AS PERIODTYPE
	,PTYP_ID
	,C_PTYP_ORDER
	,ACTUAL_1_BILLS
	,ACTUAL_5_BILLS
	,ACTUAL_10_BILLS
	,ACTUAL_20_BILLS
	,ACTUAL_50_BILLS
	,ACTUAL_100_BILLS
	,ACTUAL_1_BILLS_CNT
	,ACTUAL_5_BILLS_CNT
	,ACTUAL_10_BILLS_CNT
	,ACTUAL_20_BILLS_CNT
	,ACTUAL_50_BILLS_CNT
	,ACTUAL_100_BILLS_CNT
	,ACTUAL_TKTINCASH
	,ACTUAL_TKTINNONCASH + ACTUAL_NONCASH_COUPON_VAL AS ACTUAL_TKTINNONCASH
	,ACTUAL_TKTINPROMOCASH + ACTUAL_CASH_COUPON_VAL AS ACTUAL_TKTINPROMOCASH
	,ACTUAL_TKTINCNTCASH
	,ACTUAL_TKTINCNTNONCASH
	,ACTUAL_TKTINCNTPROMOCASH
	,PENDING_CSHBL_VCHR
	,PENDING_NONCSHBLE_VCHR
	,PENDING_PROMO_VCHR
	,PENDING_CSHBL_VCHR_CNT
	,PENDING_NONCSL_VCHR_CNT
	,PENDING_PROMO_VCHR_CNT
	,ACTUAL_CASH_COUPON_VAL
	,ACTUAL_NONCASH_COUPON_VAL
	,ACTUAL_CASH_COUPON_CNT
	,ACTUAL_NONCASH_COUPON_CNT
	,PENDING_CSHBL_COUPON_VAL
	,PENDING_NONCSHBLE_COUPON_VAL
	,PENDING_CSHBL_COUPON_CNT
	,PENDING_NONCSL_COUPON_CNT
	,CASE 
		WHEN (ACTUAL_1_BILLS + ACTUAL_5_BILLS + ACTUAL_10_BILLS + ACTUAL_20_BILLS + ACTUAL_50_BILLS + ACTUAL_100_BILLS + ACTUAL_TKTINCASH + ACTUAL_TKTINNONCASH + ACTUAL_TKTINPROMOCASH + ACTUAL_TKTINCNTCASH + ACTUAL_TKTINCNTNONCASH + ACTUAL_TKTINCNTPROMOCASH) != 0
			AND PTYP_ID = 4
			THEN 1
		ELSE 0
		END AS SOFTCOUNTFLAG
	,V_ASST_ID
	,V_NAMEDASSTID
	,V_GAMEDAY
	,upper(V_PTYP_TYPE) AS V_PTYP_TYPE
	,V_PTYP_ID
	,V_PTYP_ORDER
	,COIN.CN_ASST_ID
	,COIN.CN_NAMEDASSTID
	,COIN.CN_GAMEDAY
	,COIN.CN_PTYP_ID
	,COIN.CN_PTYP_ORDER
	,COIN.CN_PERIODTYPE
	,isnull(COIN.SCALE_AMT, 0) AS SCALE_AMT
FROM (
	SELECT ACFG_ID AS ASST_ID
		,CCRU_NAMED_ASSET_ID AS NAMEDASSTID
		,GDAY_DATE AS GAMEDAY
		,CCRUV_PTYP_ID AS PTYP_ID
		,PTYP_RPT_SEQUENCE AS C_PTYP_ORDER
		,PTYP_TYPE AS PERIODTYPE
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 7
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_1_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 8
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_5_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 9
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_10_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 10
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_20_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 11
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_50_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 12
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_100_BILLS
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 7
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_1_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 8
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_5_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 9
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_10_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 10
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_20_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 11
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_50_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 12
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_100_BILLS_CNT
	FROM Accounting.Currency_Count_Rollup_Values AS a
	INNER JOIN Accounting.Period_Type ON PTYP_ID = CCRUV_PTYP_ID
		AND PTYP_ID IN (
			2
			,3
			,4
			,5
			,6
			)
	INNER JOIN Accounting.Currency_Count_Rollup_Info AS CurrencyRollup ON CCRU_ID = CCRUV_CCRU_ID
	--join Accounting.Denomination  on DNOM_ID = CCRU_DENOMINATION_ID
	INNER JOIN Accounting.Game_Day ON GDAY_ID = CCRU_GDAY_ID
	INNER JOIN Accounting.Asset_Configuration ON ACFG_NAMED_ASSET_ID = CCRU_NAMED_ASSET_ID
		AND ACFG_IS_LATEST = 1
	--where CurrencyRollup.Deleted_TS is null
	GROUP BY GDAY_DATE
		,CCRU_NAMED_ASSET_ID
		,ACFG_ID
		,CCRUV_PTYP_ID
		,PTYP_TYPE
		,PTYP_RPT_SEQUENCE
	) AS Currency
FULL JOIN (
	SELECT ACFG_ID AS V_ASST_ID
		,VCRU_NAMED_ASSET_ID AS V_NAMEDASSTID
		,GDAY_DATE AS V_GAMEDAY
		,PTYP_TYPE AS V_PTYP_TYPE
		,PTYP_RPT_SEQUENCE AS V_PTYP_ORDER
		,VCRUV_PTYP_ID AS V_PTYP_ID
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 1
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_TKTINCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 2
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_TKTINNONCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 3
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_TKTINPROMOCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 1
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_TKTINCNTCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 2
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_TKTINCNTNONCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 3
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_TKTINCNTPROMOCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 1
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_CSHBL_VCHR
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 2
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_NONCSHBLE_VCHR
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 3
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_PROMO_VCHR
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 1
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_CSHBL_VCHR_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 2
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_NONCSL_VCHR_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 3
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_PROMO_VCHR_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 5
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_CASH_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 6
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_NONCASH_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 5
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_CASH_COUPON_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 6
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_NONCASH_COUPON_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 5
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_CSHBL_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 6
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_NONCSHBLE_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 5
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_CSHBL_COUPON_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 6
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_NONCSL_COUPON_CNT
	FROM Accounting.Voucher_Count_Rollup_Values
	INNER JOIN Accounting.Period_Type ON PTYP_ID = VCRUV_PTYP_ID
		AND PTYP_ID IN (
			2
			,3
			,4
			,5
			,6
			)
	INNER JOIN Accounting.Voucher_Count_Rollup_Info AS VoucherRollup ON VCRU_ID = VCRUV_VCRU_ID
	--join VOUCHER.STATUS  on STAT_ID = VCRU_STATUS_ID
	--join Accounting.Credit_Type  on CRTP_ID = VCRU_CRD_TYPE_ID
	INNER JOIN Accounting.Game_Day AS b ON GDAY_ID = VCRU_GDAY_ID
	INNER JOIN Accounting.Asset_Configuration ON ACFG_NAMED_ASSET_ID = VCRU_NAMED_ASSET_ID
		AND ACFG_IS_LATEST = 1
	--where VoucherRollup.Deleted_TS is null and b.Deleted_TS is null
	GROUP BY GDAY_DATE
		,VCRU_NAMED_ASSET_ID
		,ACFG_ID
		,PTYP_TYPE
		,VCRUV_PTYP_ID
		,PTYP_RPT_SEQUENCE
	) AS RedeemVoucher ON NAMEDASSTID = V_NAMEDASSTID
	AND GAMEDAY = V_GAMEDAY
	AND PERIODTYPE = V_PTYP_TYPE
FULL JOIN (
	SELECT ac.ACFG_ID AS CN_ASST_ID
		,ccri.CCRI_NAST_ID AS CN_NAMEDASSTID
		,gd.GDAY_DATE AS CN_GAMEDAY
		,ccrv.CCRV_PTYP_ID AS CN_PTYP_ID
		,pt.PTYP_RPT_SEQUENCE AS CN_PTYP_ORDER
		,pt.PTYP_TYPE AS CN_PERIODTYPE
		,sum(ccrv.CCRV_VALUE) AS SCALE_AMT
	FROM accounting.COUNTED_COIN_ROLLUP_VALUES ccrv
	INNER JOIN accounting.PERIOD_TYPE pt ON pt.PTYP_ID = ccrv.CCRV_PTYP_ID
		AND PTYP_ID IN (
			2
			,3
			,4
			,5
			,6
			)
	INNER JOIN ACCOUNTING.COUNTED_COIN_ROLLUP_INFO ccri ON ccri.CCRI_ID = ccrv.CCRV_CCRI_ID
	INNER JOIN ACCOUNTING.GAME_DAY gd ON gd.GDAY_ID = ccri.CCRI_GDAY_ID
	INNER JOIN ACCOUNTING.ASSET_CONFIGURATION ac ON ac.ACFG_NAMED_ASSET_ID = ccri.CCRI_NAST_ID
		AND ac.ACFG_IS_LATEST = 1
	GROUP BY ac.ACFG_ID
		,ccri.CCRI_NAST_ID
		,gd.GDAY_DATE
		,ccrv.CCRV_PTYP_ID
		,pt.PTYP_RPT_SEQUENCE
		,pt.PTYP_TYPE
	) AS COIN ON NAMEDASSTID = COIN.CN_NAMEDASSTID
	AND GAMEDAY = COIN.CN_GAMEDAY
	AND PERIODTYPE = COIN.CN_PERIODTYPE

UNION ALL

SELECT ASST_ID
	,NAMEDASSTID
	,GAMEDAY
	,UPPER('DAY') AS PERIODTYPE
	,1 AS PTYP_ID
	,1 AS C_PTYP_ORDER
	,ACTUAL_1_BILLS
	,ACTUAL_5_BILLS
	,ACTUAL_10_BILLS
	,ACTUAL_20_BILLS
	,ACTUAL_50_BILLS
	,ACTUAL_100_BILLS
	,ACTUAL_1_BILLS_CNT
	,ACTUAL_5_BILLS_CNT
	,ACTUAL_10_BILLS_CNT
	,ACTUAL_20_BILLS_CNT
	,ACTUAL_50_BILLS_CNT
	,ACTUAL_100_BILLS_CNT
	,ACTUAL_TKTINCASH
	,ACTUAL_TKTINNONCASH + ACTUAL_NONCASH_COUPON_VAL AS ACTUAL_TKTINNONCASH
	,ACTUAL_TKTINPROMOCASH + ACTUAL_CASH_COUPON_VAL AS ACTUAL_TKTINPROMOCASH
	,ACTUAL_TKTINCNTCASH
	,ACTUAL_TKTINCNTNONCASH
	,ACTUAL_TKTINCNTPROMOCASH
	,PENDING_CSHBL_VCHR
	,PENDING_NONCSHBLE_VCHR
	,PENDING_PROMO_VCHR
	,PENDING_CSHBL_VCHR_CNT
	,PENDING_NONCSL_VCHR_CNT
	,PENDING_PROMO_VCHR_CNT
	,ACTUAL_CASH_COUPON_VAL
	,ACTUAL_NONCASH_COUPON_VAL
	,ACTUAL_CASH_COUPON_CNT
	,ACTUAL_NONCASH_COUPON_CNT
	,PENDING_CSHBL_COUPON_VAL
	,PENDING_NONCSHBLE_COUPON_VAL
	,PENDING_CSHBL_COUPON_CNT
	,PENDING_NONCSL_COUPON_CNT
	,0 AS SOFTCOUNTFLAG
	,V_ASST_ID
	,V_NAMEDASSTID
	,V_GAMEDAY
	,UPPER('DAY') AS V_PTYP_TYPE
	,1 AS V_PTYP_ID
	,1 AS V_PTYP_ORDER
	,COIN.CN_ASST_ID
	,COIN.CN_NAMEDASSTID
	,COIN.CN_GAMEDAY
	,1 AS CN_PTYP_ID
	,1 AS CN_PTYP_ORDER
	,UPPER('DAY') AS CN_PERIODTYPE
	,isnull(COIN.SCALE_AMT, 0) AS SCALE_AMT
FROM (
	SELECT ACFG_ID AS ASST_ID
		,CCRU_NAMED_ASSET_ID AS NAMEDASSTID
		,GDAY_DATE AS GAMEDAY
		,CCRUV_PTYP_ID AS PTYP_ID
		,PTYP_RPT_SEQUENCE AS C_PTYP_ORDER
		,PTYP_TYPE AS PERIODTYPE
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 7
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_1_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 8
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_5_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 9
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_10_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 10
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_20_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 11
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_50_BILLS
		,sum(CASE 
				WHEN CCRU_DENOMINATION_ID = 12
					THEN cast(isnull(ccruv_value, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_100_BILLS
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 7
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_1_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 8
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_5_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 9
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_10_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 10
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_20_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 11
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_50_BILLS_CNT
		,SUM(CASE 
				WHEN CCRU_DENOMINATION_ID = 12
					THEN ISNULL(CCRUV_COUNT, 0)
				END) AS ACTUAL_100_BILLS_CNT
	FROM Accounting.Currency_Count_Rollup_Values AS a
	INNER JOIN Accounting.Period_Type ON PTYP_ID = CCRUV_PTYP_ID
		AND PTYP_ID IN (4)
	INNER JOIN Accounting.Currency_Count_Rollup_Info AS CurrencyRollup ON CCRU_ID = CCRUV_CCRU_ID
	--join Accounting.Denomination  on DNOM_ID = CCRU_DENOMINATION_ID
	INNER JOIN Accounting.Game_Day ON GDAY_ID = CCRU_GDAY_ID
	INNER JOIN Accounting.Asset_Configuration ON ACFG_NAMED_ASSET_ID = CCRU_NAMED_ASSET_ID
		AND ACFG_IS_LATEST = 1
	--where CurrencyRollup.Deleted_TS is null
	GROUP BY GDAY_DATE
		,CCRU_NAMED_ASSET_ID
		,ACFG_ID
		,CCRUV_PTYP_ID
		,PTYP_TYPE
		,PTYP_RPT_SEQUENCE
	) AS Currency
FULL JOIN (
	SELECT ACFG_ID AS V_ASST_ID
		,VCRU_NAMED_ASSET_ID AS V_NAMEDASSTID
		,GDAY_DATE AS V_GAMEDAY
		,PTYP_TYPE AS V_PTYP_TYPE
		,PTYP_RPT_SEQUENCE AS V_PTYP_ORDER
		,VCRUV_PTYP_ID AS V_PTYP_ID
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 1
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_TKTINCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 2
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_TKTINNONCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 3
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_TKTINPROMOCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 1
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_TKTINCNTCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 2
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_TKTINCNTNONCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 3
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_TKTINCNTPROMOCASH
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 1
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_CSHBL_VCHR
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 2
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_NONCSHBLE_VCHR
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 3
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_PROMO_VCHR
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 1
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_CSHBL_VCHR_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 2
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_NONCSL_VCHR_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 3
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_PROMO_VCHR_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 5
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_CASH_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 6
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS ACTUAL_NONCASH_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 5
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_CASH_COUPON_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 3
					AND VCRU_CRD_TYPE_ID = 6
					THEN VCRUV_COUNT
				ELSE 0
				END) AS ACTUAL_NONCASH_COUPON_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 5
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_CSHBL_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 6
					THEN cast(isnull(VCRUV_VALUE, 0) AS FLOAT) / 100
				ELSE 0
				END) AS PENDING_NONCSHBLE_COUPON_VAL
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 5
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_CSHBL_COUPON_CNT
		,sum(CASE 
				WHEN VCRU_STATUS_ID = 2
					AND VCRU_CRD_TYPE_ID = 6
					THEN VCRUV_COUNT
				ELSE 0
				END) AS PENDING_NONCSL_COUPON_CNT
	FROM Accounting.Voucher_Count_Rollup_Values
	INNER JOIN Accounting.Period_Type ON PTYP_ID = VCRUV_PTYP_ID
		AND PTYP_ID IN (4)
	INNER JOIN Accounting.Voucher_Count_Rollup_Info AS VoucherRollup ON VCRU_ID = VCRUV_VCRU_ID
	--join VOUCHER.STATUS  on STAT_ID = VCRU_STATUS_ID
	--join Accounting.Credit_Type  on CRTP_ID = VCRU_CRD_TYPE_ID
	INNER JOIN Accounting.Game_Day AS b ON GDAY_ID = VCRU_GDAY_ID
	INNER JOIN Accounting.Asset_Configuration ON ACFG_NAMED_ASSET_ID = VCRU_NAMED_ASSET_ID
		AND ACFG_IS_LATEST = 1
	--where VoucherRollup.Deleted_TS is null and b.Deleted_TS is null
	GROUP BY GDAY_DATE
		,VCRU_NAMED_ASSET_ID
		,ACFG_ID
		,PTYP_TYPE
		,VCRUV_PTYP_ID
		,PTYP_RPT_SEQUENCE
	) AS RedeemVoucher ON NAMEDASSTID = V_NAMEDASSTID
	AND GAMEDAY = V_GAMEDAY
	AND PERIODTYPE = V_PTYP_TYPE
FULL JOIN (
	SELECT ac.ACFG_ID AS CN_ASST_ID
		,ccri.CCRI_NAST_ID AS CN_NAMEDASSTID
		,gd.GDAY_DATE AS CN_GAMEDAY
		,ccrv.CCRV_PTYP_ID AS CN_PTYP_ID
		,pt.PTYP_RPT_SEQUENCE AS CN_PTYP_ORDER
		,pt.PTYP_TYPE AS CN_PERIODTYPE
		,sum(ccrv.CCRV_VALUE) AS SCALE_AMT
	FROM accounting.COUNTED_COIN_ROLLUP_VALUES ccrv
	INNER JOIN accounting.PERIOD_TYPE pt ON pt.PTYP_ID = ccrv.CCRV_PTYP_ID
		AND PTYP_ID IN (4)
	INNER JOIN ACCOUNTING.COUNTED_COIN_ROLLUP_INFO ccri ON ccri.CCRI_ID = ccrv.CCRV_CCRI_ID
	INNER JOIN ACCOUNTING.GAME_DAY gd ON gd.GDAY_ID = ccri.CCRI_GDAY_ID
	INNER JOIN ACCOUNTING.ASSET_CONFIGURATION ac ON ac.ACFG_NAMED_ASSET_ID = ccri.CCRI_NAST_ID
		AND ac.ACFG_IS_LATEST = 1
	GROUP BY ac.ACFG_ID
		,ccri.CCRI_NAST_ID
		,gd.GDAY_DATE
		,ccrv.CCRV_PTYP_ID
		,pt.PTYP_RPT_SEQUENCE
		,pt.PTYP_TYPE
	) AS COIN ON NAMEDASSTID = COIN.CN_NAMEDASSTID
	AND GAMEDAY = COIN.CN_GAMEDAY
	AND PERIODTYPE = COIN.CN_PERIODTYPE;
GO


