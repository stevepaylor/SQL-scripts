--TRUNCATE TABLE StayDWH.dbo.flash_aggregate_FIX
--GO

--INSERT INTO StayDWH.dbo.flash_aggregate_FIX
--SELECT
--  tenant_id
--, property_id
--, building_name
--, room_type_code
--, rate_code
--, market_segment_code
--, [date]
--, MIN(last_updated_at) as last_updated_at
--, ROW_ID_in_raw_table
--, total_rooms
--, off_the_market
--, total_available_rooms
--, out_of_order
--, rentable_rooms
--, hold
--, departures_remaining_rooms
--, departures_remaining_guests
--, departures_remaining_adults
--, departures_remaining_children
--, departures_total_rooms
--, departures_total_guests
--, departures_total_adults
--, departures_total_children
--, arrivals_remaining_rooms
--, arrivals_remaining_guests
--, arrivals_remaining_adults
--, arrivals_remaining_children
--, arrivals_total_rooms
--, arrivals_total_guests
--, arrivals_total_adults
--, arrivals_total_children
--, stay_overs_rooms
--, stay_overs_guests
--, stay_overs_adults
--, stay_overs_children
--, no_show_rooms
--, no_show_guests
--, no_show_adults
--, no_show_children
--, totals_rooms
--, totals_guests
--, totals_adults
--, totals_children
--, same_day_rooms
--, same_day_guests
--, same_day_adults
--, same_day_children
--, walkin_rooms
--, walkin_guests
--, walkin_adults
--, walkin_children
--, reservations_no_rate_rooms
--, no_rate_guests
--, no_rate_adults
--, no_rate_children
--, rooms_vacant
--, rooms_sold
--, rooms_sold_guests
--, rooms_comped
--, rooms_comped_guests
--, rooms_occupied
--, rooms_occupied_guests
--, transient_rooms_sold
--, transient_rooms_sold_guests
--, group_rooms_sold
--, group_rooms_sold_guests
--, room_type_sold
--, groups_not_picked_up
--, availability_no_rate_rooms
--, room_revenue
--, room_revenue_transient
--, room_revenue_group
--, historic
--, room_revenue_total
--, room_revenue_tax
--, room_revenue_transient_total
--, room_revenue_transient_tax
--, room_revenue_group_total
--, room_revenue_group_tax
--, room_type_name
--, rate_name
--, market_segment_name
--, originated_room_revenue
--, originated_room_revenue_transient
--, originated_room_revenue_group
--, originated_room_revenue_total
--, originated_room_revenue_tax
--, originated_room_revenue_transient_total
--, originated_room_revenue_transient_tax
--, originated_room_revenue_group_total
--, originated_room_revenue_group_tax
--, redemption_stay
----, COUNT(*) as Local_ETL_Number_of_Original_Detail_Rows
--, MAX(Local_ETL_Number_of_Original_Detail_Rows) as Local_ETL_Number_of_Original_Detail_Rows
--, MIN(Local_ETL_Inserted_TS) as Local_ETL_Inserted_TS
----, Local_ETL_Inserted_TS
--, MIN(Local_ETL_Updated_TS) as Local_ETL_Updated_TS

--FROM StayDWH.dbo.flash_aggregate

--GROUP BY
--  tenant_id
--, property_id
--, building_name
--, room_type_code
--, rate_code
--, market_segment_code
--, [date]
----, last_updated_at
--, ROW_ID_in_raw_table
--, total_rooms
--, off_the_market
--, total_available_rooms
--, out_of_order
--, rentable_rooms
--, hold
--, departures_remaining_rooms
--, departures_remaining_guests
--, departures_remaining_adults
--, departures_remaining_children
--, departures_total_rooms
--, departures_total_guests
--, departures_total_adults
--, departures_total_children
--, arrivals_remaining_rooms
--, arrivals_remaining_guests
--, arrivals_remaining_adults
--, arrivals_remaining_children
--, arrivals_total_rooms
--, arrivals_total_guests
--, arrivals_total_adults
--, arrivals_total_children
--, stay_overs_rooms
--, stay_overs_guests
--, stay_overs_adults
--, stay_overs_children
--, no_show_rooms
--, no_show_guests
--, no_show_adults
--, no_show_children
--, totals_rooms
--, totals_guests
--, totals_adults
--, totals_children
--, same_day_rooms
--, same_day_guests
--, same_day_adults
--, same_day_children
--, walkin_rooms
--, walkin_guests
--, walkin_adults
--, walkin_children
--, reservations_no_rate_rooms
--, no_rate_guests
--, no_rate_adults
--, no_rate_children
--, rooms_vacant
--, rooms_sold
--, rooms_sold_guests
--, rooms_comped
--, rooms_comped_guests
--, rooms_occupied
--, rooms_occupied_guests
--, transient_rooms_sold
--, transient_rooms_sold_guests
--, group_rooms_sold
--, group_rooms_sold_guests
--, room_type_sold
--, groups_not_picked_up
--, availability_no_rate_rooms
--, room_revenue
--, room_revenue_transient
--, room_revenue_group
--, historic
--, room_revenue_total
--, room_revenue_tax
--, room_revenue_transient_total
--, room_revenue_transient_tax
--, room_revenue_group_total
--, room_revenue_group_tax
--, room_type_name
--, rate_name
--, market_segment_name
--, originated_room_revenue
--, originated_room_revenue_transient
--, originated_room_revenue_group
--, originated_room_revenue_total
--, originated_room_revenue_tax
--, originated_room_revenue_transient_total
--, originated_room_revenue_transient_tax
--, originated_room_revenue_group_total
--, originated_room_revenue_group_tax
--, redemption_stay
----, Local_ETL_Number_of_Original_Detail_Rows
----, Local_ETL_Inserted_TS
----, Local_ETL_Updated_TS

SELECT * 
INTO StayDWH.dbo.flash_aggregate_SAVE_1126
FROM StayDWH.dbo.flash_aggregate

TRUNCATE TABLE StayDWH.dbo.flash_aggregate

INSERT INTO StayDWH.dbo.flash_aggregate
SELECT * 
FROM StayDWH.dbo.flash_aggregate_FIX
