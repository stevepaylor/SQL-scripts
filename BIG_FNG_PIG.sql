SELECT TRANS_SITEID, TCT_DATETIME, TCT_DATETIME_TM, EVMA_EXCEPTION_CODE, TCT_EMP_ID, TCT_LOGIN, TCT_SLOT, TCT_SLOT_ADDRESS, CASE STATUS_ID      WHEN 3 THEN TCT_TICKET_BARCODE      ELSE CASE   WHEN ticket_typeid != 6 THEN LEFT (TCT_TICKET_BARCODE, 14)        + '***' + RIGHT (TCT_TICKET_BARCODE, 1)         ELSE LEFT (TCT_TICKET_BARCODE, 10) + '***' + RIGHT (TCT_TICKET_BARCODE, 5)    END END AS TCT_TICKET_BARCODE, TCT_BILLS_IN, TCT_COIN_IN, TCT_COIN_OUT, TCT_COIN_DROP, TCT_TKT_AMT_IN, TCT_TKT_AMT_OUT, AMOUNT_LEFT_ON_CREDITMETER, STATUS_ID, TCT_LOCATION, TCT_TICKET_TYPE, TCT_AMOUNT, TCT_LOCATION, TCT_DESCRIPTION, TCT_TKT_REDEEM_TIME FROM   (     SELECT TRANS_SITEID,     VOUCHER_SITEID,     Grp_ID,     TCT_DATETIME,     TCT_DATETIME_TM,     EVMA_EXCEPTION_CODE,     TCT_EMP_ID, TCT_LOGIN,     TCT_SLOT,     TCT_SLOT_ADDRESS,     TCT_TICKET_BARCODE,     TCT_BILLS_IN,     TCT_COIN_IN,     TCT_COIN_OUT,     TCT_COIN_DROP,     TCT_TKT_AMT_IN,     TCT_TKT_AMT_OUT,     AMOUNT_LEFT_ON_CREDITMETER,     STATUS_ID,     TCT_TICKET_TYPE,     TCT_AMOUNT,     TCT_DESCRIPTION,     TCT_TKT_REDEEM_TIME,     ticket_typeid,     TCT_LOCATION,     CASE    WHEN EVMA_EXCEPTION_CODE IN (38, 307, 308, 309)     AND (      (   TCT_COIN_IN <> 0   OR TCT_COIN_OUT <> 0   OR TCT_COIN_DROP <> 0   OR TCT_TKT_AMT_IN <> 0   OR TCT_TKT_AMT_OUT <> 0   OR TCT_BILLS_IN <> 0      )      OR (TCT_DESCRIPTION != '' AND TCT_DESCRIPTION IS NOT NULL)  ) THEN 'Y' WHEN evma_Exception_code = 37 THEN 'Y' ELSE 'N' END AS   FLAG FROM (      SELECT D_TM.TRMA_SITE_ID AS TRANS_SITEID,      TKT.SITE_ID AS VOUCHER_SITEID,      DELTA.TRMA_TRANSACTION_LOGID AS Grp_ID,      DELTA.DELTA_CARD_IN_TIME AS TCT_DATETIME,      D_TM.TRMA_REQUEST_DATETIME AS TCT_DATETIME_TM,      EM.EVMA_EXCEPTION_CODE,      D_TM.STDA_EMPLOYEE_CARDNUM AS TCT_EMP_ID, D_TM.STDA_EMPLOYEE_ID AS TCT_LOGIN,     D_TM.TRMA_ACNF_NUMBER AS TCT_SLOT,      D_TM.TRMA_LINE_ADDRESS AS TCT_SLOT_ADDRESS,      TKT.TKT_BARCODE AS TCT_TICKET_BARCODE,      ( (     (  (      CAST(DELTA.DELTA_BILL_1 AS FLOAT) * (   SELECT DNOM_VALUE   FROM   ACCOUNTING.DENOMINATION   WHERE  DNOM_CODE = '$1'      ) + CAST(DELTA.DELTA_BILL_5 AS FLOAT)       * (   SELECT DNOM_VALUE   FROM   ACCOUNTING.DENOMINATION   WHERE  DNOM_CODE = '$5'      )  ) + CAST(DELTA.DELTA_BILL_10 AS FLOAT) * (      SELECT DNOM_VALUE      FROM   ACCOUNTING.DENOMINATION      WHERE  DNOM_CODE = '$10'  )     ) + CAST(DELTA.DELTA_BILL_20 AS FLOAT) * (  SELECT DNOM_VALUE  FROM   ACCOUNTING.DENOMINATION  WHERE  DNOM_CODE = '$20'     ) ) + CAST(DELTA.DELTA_BILL_50 AS FLOAT) * (     SELECT DNOM_VALUE     FROM   ACCOUNTING.DENOMINATION     WHERE  DNOM_CODE = '$50' )      ) + CAST(DELTA.DELTA_BILL_100 AS FLOAT) * ( SELECT DNOM_VALUE FROM   ACCOUNTING.DENOMINATION WHERE  DNOM_CODE = '$100'      ) AS TCT_BILLS_IN,      CAST(DELTA.DELTA_BETS AS FLOAT) * t1.gmu_denom / 100 AS       TCT_COIN_IN,      CAST(DELTA.DELTA_WINS AS FLOAT) * t1.gmu_denom / 100 AS       TCT_COIN_OUT,      CAST(DELTA.DELTA_COINS_DROP AS FLOAT) * t1.gmu_denom /      100 AS TCT_COIN_DROP,      ( CAST(DELTA.DELTA_TKTCSHBLE_IN AS FLOAT) + CAST(DELTA.DELTA_TKTNONCSHBLE_IN AS FLOAT)      ) / 100 AS TCT_TKT_AMT_IN,      ( CAST(DELTA.DELTA_TKTCSHBLE_OUT AS FLOAT) + CAST(DELTA.DELTA_TKTNONCSHBLE_OUT AS FLOAT)      ) / 100 AS TCT_TKT_AMT_OUT,      ( ( (     (  (      ( (     (  (      (   (   (       CAST(DELTA.DELTA_BILL_1 AS FLOAT) * (    SELECT   DNOM_VALUE    FROM     ACCOUNTING.DENOMINATION    WHERE    DNOM_CODE =   '$1'       ) +       CAST(DELTA.DELTA_BILL_5 AS FLOAT) * (    SELECT   DNOM_VALUE    FROM     ACCOUNTING.DENOMINATION    WHERE    DNOM_CODE =   '$5'       )   ) + CAST(DELTA.DELTA_BILL_10 AS FLOAT)    * (       SELECT        DNOM_VALUE       FROM ACCOUNTING.DENOMINATION       WHERE  DNOM_CODE =        '$10'   )   ) + CAST(DELTA.DELTA_BILL_20 AS FLOAT)    * (   SELECT    DNOM_VALUE   FROM      ACCOUNTING.DENOMINATION   WHERE     DNOM_CODE =    '$20'   )      ) + CAST(DELTA.DELTA_BILL_50 AS FLOAT)       * (   SELECT       DNOM_VALUE   FROM  ACCOUNTING.DENOMINATION   WHERE DNOM_CODE =       '$50'      )  ) + CAST(DELTA.DELTA_BILL_100 AS FLOAT)   * ( SELECT DNOM_VALUE FROM   ACCOUNTING.DENOMINATION WHERE  DNOM_CODE =   '$100'  )     ) + CAST(DELTA.DELTA_COINS_PURCHASED AS FLOAT)      * t1.fill_denom / 100 ) + CAST(DELTA.DELTA_WINS AS FLOAT)  * t1.gmu_denom / 100      ) + CAST(DELTA.DELTA_TKTCSHBLE_IN AS FLOAT)       / 100  ) + CAST(DELTA.DELTA_TKTNONCSHBLE_IN AS FLOAT)   / 100     ) - CAST(DELTA.DELTA_TKTNONCSHBLE_OUT AS FLOAT)      / 100 ) - CAST(DELTA.DELTA_BETS AS FLOAT) * t1.gmu_denom  / 100 ) - CAST(DELTA.DELTA_COINS_COLLECTED AS FLOAT) * t1.fill_denom / 100    ) - CAST(DELTA.DELTA_TKTCSHBLE_OUT AS FLOAT) / 100 AS     AMOUNT_LEFT_ON_CREDITMETER,    STS.STAT_ID AS STATUS_ID,    (CASE WHEN STS.STAT_ID = 3 THEN TRS.TRANS_LOCATION_NUMBER ELSE '' END) AS     TCT_LOCATION,    ( CASE   WHEN STS.STAT_ID = 3 THEN 'REDEEMED' + ':'  ELSE 'NOT REDEEMED' END    ) AS TCT_TICKET_TYPE,    TKT.TKT_AMOUNT AS TCT_AMOUNT,    DELTA.DESCRIPTION AS TCT_DESCRIPTION,    TRS.TRANS_DATETIME AS TCT_TKT_REDEEM_TIME,    TKTTYPE.TICKET_TYPE_ID AS ticket_typeid    FROM   VOUCHER.TICKET_TYPE AS TKTTYPE    INNER JOIN VOUCHER.TICKET AS TKT    INNER JOIN VOUCHER.TRANS AS TRS  ON  TKT.TKT_ID = TRS.TKT_ID    INNER JOIN VOUCHER.STATUS AS STS  ON  TRS.STAT_ID = STS.STAT_ID  ON  TKTTYPE.TICKET_TYPE_ID = TKT.TICKET_TYPE_ID    RIGHT OUTER JOIN REPORT.VIEW_RID0194_CR0055_TENCOINTESTREPORT AS   D_TM    INNER JOIN [TRANSACTION].METDELTA_BETEMPCARDINOUT AS   DELTA  ON  DELTA.TRMA_TRANSACTION_LOGID = D_TM.TRMA_TRANSACTION_LOGID  AND D_TM.TRMA_REQUEST_DATETIME BETWEEN DELTA.DELTA_CARD_IN_TIME   AND D_TM.TRMA_REQUEST_DATETIME    INNER JOIN [TRANSACTION].EVENT_MASTER AS EM  ON  D_TM.EVMA_EVENT_ID = EM.EVMA_EVENT_ID  ON  TRS.MSG_ID = D_TM.TRMA_MESSAGE_ID    INNER JOIN (  SELECT acnf_number,  SITE.site_number,  CASE        WHEN opt.fill_denom = ''  OR opt.fill_denom IS NULL THEN 0 ELSE CAST(opt.fill_denom AS FLOAT)      * 100 END AS fill_denom,  CASE WHEN opt.gmu_denom = ''  OR opt.gmu_denom IS NULL THEN 0 ELSE CAST(opt.gmu_denom AS FLOAT)      * 100 END AS gmu_denom FROM asset.asset_configuration      conf INNER JOIN asset.asset_configuration_option      opt ON conf.acnf_id = opt.acnf_id INNER      JOIN asset.area area ON conf.area_id =     area.area_id INNER JOIN siteconfig.site      SITE ON SITE.site_number = area.site_id      WHERE ACNF_DELETED_TS IS NULL  ) AS t1  ON  t1.site_number = d_tm.trma_site_id  AND t1.acnf_number = d_tm.trma_acnf_number    WHERE  (EM.EVMA_EXCEPTION_CODE IN (37, 38, 307, 308, 309))    OR  (STS.STAT_ID = 3) UNION  SELECT D_TM.TRMA_SITE_ID AS  TRANS_SITEID, TKT.SITE_ID AS  VOUCHER_SITEID, DELTA.TRMA_TRANSACTION_LOGID AS  Grp_ID, DELTA.DELTA_CARD_IN_TIME AS  TCT_DATETIME, D_TM.TRMA_REQUEST_DATETIME AS  TCT_DATETIME_TM, EM.EVMA_EXCEPTION_CODE, D_TM.STDA_EMPLOYEE_CARDNUM AS  TCT_EMP_ID,D_TM.STDA_EMPLOYEE_ID AS TCT_LOGIN, D_TM.TRMA_ACNF_NUMBER AS  TCT_SLOT, D_TM.TRMA_LINE_ADDRESS AS  TCT_SLOT_ADDRESS, TKT.TKT_BARCODE AS  TCT_TICKET_BARCODE, (   (   (       (    CAST(DELTA.DELTA_BILL_1 AS FLOAT)     * (        SELECT       DNOM_VALUE        FROM  ACCOUNTING.DENOMINATION        WHERE DNOM_CODE =       '$1'    )     +    CAST(DELTA.DELTA_BILL_5 AS FLOAT)     * (        SELECT       DNOM_VALUE        FROM  ACCOUNTING.DENOMINATION        WHERE DNOM_CODE =       '$5'    )       ) +       CAST(DELTA.DELTA_BILL_10 AS FLOAT) * (    SELECT   DNOM_VALUE    FROM     ACCOUNTING.DENOMINATION    WHERE    DNOM_CODE =   '$10'       )   ) + CAST(DELTA.DELTA_BILL_20 AS FLOAT)    * (       SELECT        DNOM_VALUE       FROM ACCOUNTING.DENOMINATION       WHERE  DNOM_CODE =        '$20'   )   ) + CAST(DELTA.DELTA_BILL_50 AS FLOAT)    * (   SELECT    DNOM_VALUE   FROM      ACCOUNTING.DENOMINATION   WHERE     DNOM_CODE =    '$50'   ) ) + CAST(DELTA.DELTA_BILL_100 AS FLOAT)  * (   SELECT       DNOM_VALUE   FROM  ACCOUNTING.DENOMINATION   WHERE DNOM_CODE =       '$100' ) AS TCT_BILLS_IN, CAST(DELTA.DELTA_BETS AS FLOAT)  * t1.gmu_denom / 100 AS TCT_COIN_IN, CAST(DELTA.DELTA_WINS AS FLOAT)  * t1.gmu_denom / 100 AS  TCT_COIN_OUT, CAST(DELTA.DELTA_COINS_DROP AS FLOAT)  * t1.gmu_denom / 100 AS  TCT_COIN_DROP, (   CAST(DELTA.DELTA_TKTCSHBLE_IN AS FLOAT)    + CAST(DELTA.DELTA_TKTNONCSHBLE_IN AS FLOAT) ) / 100 AS  TCT_TKT_AMT_IN, (   CAST(DELTA.DELTA_TKTCSHBLE_OUT AS FLOAT)    + CAST(DELTA.DELTA_TKTNONCSHBLE_OUT AS FLOAT) ) / 100 AS  TCT_TKT_AMT_OUT, (   (   (       (    (        (   (       (    ( (     (     (  CAST(DELTA.DELTA_BILL_1 AS FLOAT)   * (      SELECT     DNOM_VALUE      FROM       ACCOUNTING.DENOMINATION      WHERE      DNOM_CODE =     '$1'  )  +  CAST(DELTA.DELTA_BILL_5 AS FLOAT)   * (      SELECT     DNOM_VALUE      FROM       ACCOUNTING.DENOMINATION      WHERE      DNOM_CODE =     '$5'  )     )      +     CAST(DELTA.DELTA_BILL_10 AS FLOAT)      * (  SELECT DNOM_VALUE  FROM   ACCOUNTING.DENOMINATION  WHERE  DNOM_CODE = '$10'     )     )      +     CAST(DELTA.DELTA_BILL_20 AS FLOAT)      * (     SELECT      DNOM_VALUE     FROM        ACCOUNTING.DENOMINATION     WHERE       DNOM_CODE =      '$20'     ) )  + CAST(DELTA.DELTA_BILL_50 AS FLOAT)  * (     SELECT  DNOM_VALUE     FROM    ACCOUNTING.DENOMINATION     WHERE   DNOM_CODE =  '$50' )    )     +    CAST(DELTA.DELTA_BILL_100 AS FLOAT)     * ( SELECT     DNOM_VALUE FROM       ACCOUNTING.DENOMINATION WHERE      DNOM_CODE =     '$100'    )       ) +       CAST(DELTA.DELTA_COINS_PURCHASED AS FLOAT) *       t1.fill_denom /       100   )    +   CAST(DELTA.DELTA_WINS AS FLOAT)    *   t1.gmu_denom    /   100        )  +        CAST(DELTA.DELTA_TKTCSHBLE_IN AS FLOAT)  /        100    )     +    CAST(DELTA.DELTA_TKTNONCSHBLE_IN AS FLOAT)     /    100       ) - CAST(DELTA.DELTA_TKTNONCSHBLE_OUT AS FLOAT) / 100   ) - CAST(DELTA.DELTA_BETS AS FLOAT)    * t1.gmu_denom    / 100   ) - CAST(DELTA.DELTA_COINS_COLLECTED AS FLOAT)    * t1.fill_denom    / 100 ) - CAST(DELTA.DELTA_TKTCSHBLE_OUT AS FLOAT)  / 100 AS  AMOUNT_LEFT_ON_CREDITMETER, STS.STAT_ID AS  STATUS_ID, (CASE WHEN STS.STAT_ID = 3 THEN TRS.TRANS_LOCATION_NUMBER ELSE '' END) AS  TCT_LOCATION, (   CASE     WHEN STS.STAT_ID   = 3 THEN   'REDEEMED'   +  ':'    ELSE   'NOT REDEEMED'   END ) AS  TCT_TICKET_TYPE, TKT.TKT_AMOUNT AS  TCT_AMOUNT, DELTA.DESCRIPTION AS  TCT_DESCRIPTION, TRS.TRANS_DATETIME AS  TCT_TKT_REDEEM_TIME, TKTTYPE.TICKET_TYPE_ID AS  ticket_typeid      FROM   VOUCHER.TICKET_TYPE AS  TKTTYPE INNER JOIN VOUCHER.TICKET AS     TKT INNER JOIN VOUCHER.TRANS AS     TRS    ON  TKT.TKT_ID =     TRS.TKT_ID INNER JOIN VOUCHER.STATUS AS     STS    ON  TRS.STAT_ID =     STS.STAT_ID    ON  TKTTYPE.TICKET_TYPE_ID =     TKT.TICKET_TYPE_ID RIGHT OUTER JOIN     REPORT.VIEW_RID0194_CR0055_TENCOINTESTREPORT AS     D_TM INNER JOIN     [TRANSACTION].METDELTA_BETEMPCARDINOUT AS     DELTA    ON  DELTA.TRMA_TRANSACTION_LOGID =     D_TM.TRMA_TRANSACTION_LOGID INNER JOIN REPORT.VIEW_RID0194_CR0055_TENCOINTESTREPORT AS     tm    ON  d_tm.trma_acnf_number =     tm.trma_acnf_number INNER JOIN     [TRANSACTION].EVENT_MASTER AS     EM    ON  TM.EVMA_EVENT_ID =     EM.EVMA_EVENT_ID    ON  TRS.MSG_ID =     TM.TRMA_MESSAGE_ID    AND TM.TRMA_REQUEST_DATETIME     BETWEEN     DELTA.DELTA_CARD_IN_TIME     AND Dateadd(mi, Cast((SELECT                CASE        WHEN        VAL_TYPE.VTYP_ID = 1 THEN VAL.        VAL_JURISDICTION_VALUE        WHEN        VAL_TYPE.VTYP_ID = 2 THEN        VAL.VAL_ORGANIZATION_VALUE        WHEN VAL_TYPE.VTYP_ID = 3 THEN VAL.VAL_SITE_VALUE        WHEN VAL_TYPE.VTYP_ID = 4        AND ( VAL.VAL_JURISDICTION_VALUE <        VAL.VAL_ORGANIZATION_VALUE )        AND ( VAL.VAL_JURISDICTION_VALUE <        VAL.VAL_SITE_VALUE ) THEN        VAL.VAL_JURISDICTION_VALUE        WHEN VAL_TYPE.VTYP_ID = 4        AND ( VAL.VAL_ORGANIZATION_VALUE <        VAL.VAL_JURISDICTION_VALUE )        AND ( VAL.VAL_ORGANIZATION_VALUE <        VAL.VAL_SITE_VALUE ) THEN        VAL.VAL_ORGANIZATION_VALUE        WHEN VAL_TYPE.VTYP_ID = 4        AND ( VAL.VAL_SITE_VALUE <        VAL.VAL_JURISDICTION_VALUE )        AND ( VAL.VAL_SITE_VALUE <        VAL.VAL_ORGANIZATION_VALUE ) THEN        VAL.VAL_SITE_VALUE        WHEN VAL_TYPE.VTYP_ID = 5        AND ( VAL.VAL_JURISDICTION_VALUE > VAL.        VAL_ORGANIZATION_VALUE )        AND ( VAL.VAL_JURISDICTION_VALUE >        VAL.VAL_SITE_VALUE ) THEN        VAL.VAL_JURISDICTION_VALUE        WHEN VAL_TYPE.VTYP_ID = 5        AND ( VAL.VAL_ORGANIZATION_VALUE >        VAL.VAL_JURISDICTION_VALUE )        AND ( VAL.VAL_ORGANIZATION_VALUE >        VAL.VAL_SITE_VALUE ) THEN        VAL.VAL_ORGANIZATION_VALUE        WHEN VAL_TYPE.VTYP_ID = 5        AND ( VAL.VAL_SITE_VALUE >        VAL.VAL_JURISDICTION_VALUE )        AND ( VAL.VAL_SITE_VALUE >        VAL.VAL_ORGANIZATION_VALUE ) THEN        VAL.VAL_SITE_VALUE        WHEN VAL_TYPE.VTYP_ID = 6        AND ( VAL.VAL_JURISDICTION_VALUE = 'YES'        OR VAL.VAL_ORGANIZATION_VALUE = 'YES'        OR VAL.VAL_SITE_VALUE = 'YES' ) THEN        'YES'        WHEN VAL_TYPE.VTYP_ID = 6        AND ( VAL.VAL_JURISDICTION_VALUE = 'NO'        AND VAL.VAL_ORGANIZATION_VALUE = 'NO'        AND VAL.VAL_SITE_VALUE = 'NO' ) THEN 'NO'        WHEN VAL_TYPE.VTYP_ID = 7        AND ( VAL.VAL_JURISDICTION_VALUE = 'YES'        AND VAL.VAL_ORGANIZATION_VALUE = 'YES'        AND VAL.VAL_SITE_VALUE = 'YES' ) THEN        'YES'        WHEN VAL_TYPE.VTYP_ID = 7        AND ( VAL.VAL_JURISDICTION_VALUE = 'NO'        OR VAL.VAL_ORGANIZATION_VALUE = 'NO'        OR VAL.VAL_SITE_VALUE = 'NO' ) THEN 'NO'        ELSE NULL        END AS VALUE        FROM   siteconfig.SITE ST        INNER JOIN siteconfig.VALUE AS VAL        ON VAL.VAL_SITE_ID = ST.SITE_ID        AND ST.SITE_NUMBER =   209        AND VAL.VAL_DELETED_TS IS NULL        INNER JOIN siteconfig.CONFIGURATION AS CONF        ON CONF.CONF_ID = VAL.CONF_ID        AND CONF.CONF_NAME = 'MINS.TO.CHCK.TICKTS'        INNER JOIN siteconfig.VALUE_TYPE VAL_TYPE        ON VAL_TYPE.VTYP_ID = CONF.VTYP_ID        INNER JOIN siteconfig.VALUE_DATA_TYPE VAL_DATA         ON VAL_DATA.VDTY_ID = VAL.VDTY_ID        INNER JOIN siteconfig.CATEGORY AS CAT        ON CAT.CAT_ID = CONF.CAT_ID        AND CAT.CAT_NAME = 'REPORT.GENERAL.PARAMETERS') AS        INT), D_TM.TRMA_REQUEST_DATETIME)   AND D_TM.TRMA_REQUEST_DATETIME     BETWEEN     DELTA.DELTA_CARD_IN_TIME     AND     DATEADD( mi, CAST(     (  SELECT CASE WHEN    VAL_TYPE.VTYP_ID    =   1 THEN    VAL. VAL_JURISDICTION_VALUE     WHEN    VAL_TYPE.VTYP_ID    =   2 THEN    VAL.VAL_ORGANIZATION_VALUE     WHEN    VAL_TYPE.VTYP_ID    =   3 THEN    VAL.VAL_SITE_VALUE     WHEN    VAL_TYPE.VTYP_ID    =   4  AND (VAL.VAL_JURISDICTION_VALUE < VAL.VAL_ORGANIZATION_VALUE)  AND (VAL.VAL_JURISDICTION_VALUE < VAL.VAL_SITE_VALUE)     THEN     VAL.VAL_JURISDICTION_VALUE     WHEN     VAL_TYPE.VTYP_ID     =    4  AND (VAL.VAL_ORGANIZATION_VALUE < VAL.VAL_JURISDICTION_VALUE)  AND (VAL.VAL_ORGANIZATION_VALUE < VAL.VAL_SITE_VALUE)     THEN     VAL.VAL_ORGANIZATION_VALUE     WHEN     VAL_TYPE.VTYP_ID     =    4  AND (VAL.VAL_SITE_VALUE < VAL.VAL_JURISDICTION_VALUE)  AND (VAL.VAL_SITE_VALUE < VAL.VAL_ORGANIZATION_VALUE)     THEN     VAL.VAL_SITE_VALUE     WHEN     VAL_TYPE.VTYP_ID     =    5  AND (VAL.VAL_JURISDICTION_VALUE > VAL. VAL_ORGANIZATION_VALUE)  AND (VAL.VAL_JURISDICTION_VALUE > VAL.VAL_SITE_VALUE)     THEN     VAL.VAL_JURISDICTION_VALUE     WHEN     VAL_TYPE.VTYP_ID     =    5  AND (VAL.VAL_ORGANIZATION_VALUE > VAL.VAL_JURISDICTION_VALUE)  AND (VAL.VAL_ORGANIZATION_VALUE > VAL.VAL_SITE_VALUE)     THEN     VAL.VAL_ORGANIZATION_VALUE     WHEN     VAL_TYPE.VTYP_ID     =    5  AND (VAL.VAL_SITE_VALUE > VAL.VAL_JURISDICTION_VALUE)  AND (VAL.VAL_SITE_VALUE > VAL.VAL_ORGANIZATION_VALUE)     THEN     VAL.VAL_SITE_VALUE     WHEN     VAL_TYPE.VTYP_ID     =    6  AND ( VAL.VAL_JURISDICTION_VALUE = 'YES' OR     VAL.VAL_ORGANIZATION_VALUE     =    'YES' OR     VAL.VAL_SITE_VALUE     =    'YES'    )     THEN     'YES'     WHEN     VAL_TYPE.VTYP_ID     =    6  AND ( VAL.VAL_JURISDICTION_VALUE  = 'NO' AND VAL.VAL_ORGANIZATION_VALUE =     'NO' AND VAL.VAL_SITE_VALUE =     'NO'    )     THEN     'NO'     WHEN     VAL_TYPE.VTYP_ID     =    7  AND ( VAL.VAL_JURISDICTION_VALUE = 'YES' AND VAL.VAL_ORGANIZATION_VALUE =     'YES' AND VAL.VAL_SITE_VALUE =     'YES'    )     THEN     'YES'     WHEN     VAL_TYPE.VTYP_ID     =    7  AND ( VAL.VAL_JURISDICTION_VALUE = 'NO' OR     VAL.VAL_ORGANIZATION_VALUE     =    'NO' OR     VAL.VAL_SITE_VALUE     =    'NO'    )     THEN     'NO'     ELSE     NULL     END     AS     VALUE     FROM     SITECONFIG.SITE     ST     INNER     JOIN     SITECONFIG.VALUE     AS     VAL     ON     VAL.VAL_SITE_ID     =    ST.SITE_ID  AND     ST.SITE_NUMBER     =     209  AND     VAL.VAL_DELETED_TS     IS     NULL     INNER     JOIN     SITECONFIG.CONFIGURATION     AS     CONF     ON     CONF.CONF_ID     =    VAL.CONF_ID  AND     CONF.CONF_NAME     =    'MINS.TO.CHCK.TICKTS'     INNER     JOIN     siteconfig.VALUE_TYPE     VAL_TYPE     ON     VAL_TYPE.VTYP_ID    =    CONF.VTYP_ID     INNER     JOIN     siteconfig.VALUE_DATA_TYPE     VAL_DATA     ON     VAL_DATA.VDTY_ID    =    VAL.VDTY_ID     INNER     JOIN     SITECONFIG.CATEGORY     AS     CAT     ON     CAT.CAT_ID     =    CONF.CAT_ID  AND     CAT.CAT_NAME     =    'REPORT.GENERAL.PARAMETERS'     )      AS      INT ), D_TM.TRMA_REQUEST_DATETIME    ) INNER JOIN (    SELECT     acnf_number,    SITE.site_number,    CASE WHEN      opt.fill_denom     =     ''    OR opt.fill_denom IS NULL THEN 0 ELSE CAST(opt.fill_denom AS FLOAT) * 100 END AS fill_denom,    CASE   WHEN        opt.gmu_denom       =       ''    OR opt.gmu_denom IS NULL THEN 0 ELSE CAST(opt.gmu_denom AS FLOAT) * 100 END AS gmu_denom FROM asset.asset_configuration conf INNER JOIN asset.asset_configuration_option opt ON conf.acnf_id = opt.acnf_id INNER JOIN asset.area area ON conf.area_id = area.area_id INNER JOIN siteconfig.site SITE ON SITE.site_number = area.site_id WHERE ACNF_DELETED_TS IS NULL    ) AS t1    ON  t1.site_number =     d_tm.trma_site_id    AND t1.acnf_number =     d_tm.trma_acnf_number      WHERE  (EM.EVMA_EXCEPTION_CODE IN (307,308)) AND (STS.STAT_ID IN (1,3))  ) AS TEMP ) AS FINAL WHERE  TCT_DATETIME BETWEEN ( '2017-02-13 14:04:26.0') AND ( '2017-02-13 15:04:26.0') AND TRANS_SITEID  IN ( 209) AND FLAG = 'Y' ORDER BY  TCT_EMP_ID ASC, TCT_DATETIME ASC, TCT_SLOT ASC, EVMA_EXCEPTION_CODE
